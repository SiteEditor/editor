"use strict";var readline=require("readline");var MuteStream=require("mute-stream");var codePointAt=require("code-point-at");var isFullwidthCodePoint=require("is-fullwidth-code-point");var Interface=module.exports={};Interface.createInterface=function(opt){opt||(opt={});var filteredOpt=opt;filteredOpt.input=opt.input||process.stdin;var ms=new MuteStream;ms.pipe(opt.output||process.stdout);filteredOpt.output=ms;var rl=readline.createInterface(filteredOpt);var _refreshLine=rl._refreshLine;rl._refreshLine=function(){_refreshLine.call(rl);var line=this._prompt+this.line;var cursorPos=this._getCursorPos();readline.moveCursor(this.output,-line.length,0);readline.moveCursor(this.output,cursorPos.cols,0)};rl._getCursorPos=function(){var columns=this.columns;var strBeforeCursor=this._prompt+this.line.substring(0,this.cursor);var dispPos=this._getDisplayPos(strBeforeCursor);var cols=dispPos.cols;var rows=dispPos.rows;if(cols+1===columns&&this.cursor<this.line.length&&isFullwidthCodePoint(codePointAt(this.line,this.cursor))){rows++;cols=0}return{cols:cols,rows:rows}};rl._getDisplayPos=function(str){var offset=0;var col=this.columns;var row=0;var code;str=stripVTControlCharacters(str);for(var i=0,len=str.length;i<len;i++){code=codePointAt(str,i);if(code>=65536){i++}if(code===10){offset=0;row+=1;continue}if(isFullwidthCodePoint(code)){if((offset+1)%col===0){offset++}offset+=2}else{offset++}}var cols=offset%col;var rows=row+(offset-cols)/col;return{cols:cols,rows:rows}};var origWrite=rl._ttyWrite;rl._ttyWrite=function(s,key){key||(key={});if(key.name==="up")return;if(key.name==="down")return;origWrite.apply(this,arguments)};return rl};var metaKeyCodeReAnywhere=/(?:\x1b)([a-zA-Z0-9])/;var functionKeyCodeReAnywhere=new RegExp("(?:+)(O|N|\\[|\\[\\[)(?:"+["(\\d+)(?:;(\\d+))?([~^$])","(?:M([@ #!a`])(.)(.))","(?:1;)?(\\d+)?([a-zA-Z])"].join("|")+")");function stripVTControlCharacters(str){str=str.replace(new RegExp(functionKeyCodeReAnywhere.source,"g"),"");return str.replace(new RegExp(metaKeyCodeReAnywhere.source,"g"),"")}